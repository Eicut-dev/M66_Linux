##==========================================================================
#                   Quectel OpenCPU
#
#              Copyright(c) 2012-2013 Quectel Ltd. All rights reserved.
#
#--------------------------------------------------------------------------
# File Description
# ----------------
#      OpenCPU makefile for GCC (Linux version).
#
#--------------------------------------------------------------------------
#==========================================================================

#-------------------------------------------------------------------------------
# Configure GCC installation path and version for Linux
# You can check with: arm-none-eabi-gcc -v
#-------------------------------------------------------------------------------
# Example for Ubuntu/Debian if toolchain is installed via apt:
 GCC_INSTALL_PATH=/usr
# Example if installed manually in /opt/gcc-arm-none-eabi-4_7-2013q3
#GCC_INSTALL_PATH=/opt/gcc-arm-none-eabi-4_7-2013q3
GCC_VERSION=12.2.1

C_PREDEF=-D __CUSTOMER_CODE__

#-------------------------------------------------------------------------------
# Configure version and output target
#-------------------------------------------------------------------------------
PLATFORM = APPGS3MD
MEMORY   = M32
VERSION  = A01
TARGET   = $(strip $(PLATFORM))$(strip $(MEMORY))$(strip $(VERSION))

#-------------------------------------------------------------------------------
# Configure include directories
#-------------------------------------------------------------------------------
INCS =  -I $(ENV_INC) 
INCS += -I ./            \
        -I include       \
        -I ril/inc       \
        -I custom/config \
        -I custom/fota/inc

#-------------------------------------------------------------------------------
# Configure source code directories
#-------------------------------------------------------------------------------
SRC_DIRS = example           \
           custom            \
           custom/config     \
           custom/fota/src   \
           ril/src

#-------------------------------------------------------------------------------
# Configure source code files to compile
#-------------------------------------------------------------------------------
SRC_SYS     = $(wildcard custom/config/*.c)
SRC_SYS_RIL = $(wildcard ril/src/*.c)
SRC_EXAMPLE = $(wildcard example/*.c)
SRC_CUS     = $(wildcard custom/*.c)
SRC_FOTA    = $(wildcard custom/fota/src/*.c)

OBJ_DIR = build/gcc

OBJS = \
	$(patsubst %.c, $(OBJ_DIR)/%.o, $(SRC_SYS))        \
	$(patsubst %.c, $(OBJ_DIR)/%.o, $(SRC_SYS_RIL))    \
	$(patsubst %.c, $(OBJ_DIR)/%.o, $(SRC_EXAMPLE))    \
	$(patsubst %.c, $(OBJ_DIR)/%.o, $(SRC_CUS))        \
	$(patsubst %.c, $(OBJ_DIR)/%.o, $(SRC_FOTA))

#-------------------------------------------------------------------------------
# Configure user reference library
#-------------------------------------------------------------------------------
USERLIB = libs/gcc/app_start.lib

.PHONY: all clean help new

all:
	@$(MAKE) new -f make/gcc/gcc_makefile

#new:
#	@mkdir -p $(OBJ_DIR)
#	@cp -f libs/app_image_bin.cfg build/gcc/app_image_bin.cfg
#	@make -f make/gcc/gcc_makefile 2> build/gcc/build.log

#clean:
#	@make clean -f make/gcc/gcc_makefile
#	@rm -f build/gcc/build.log build/gcc/app_image_bin.cfg

help:
	@make help -f make/gcc/gcc_makefile

include make/gcc/gcc_makefiledef

export GCC_INSTALL_PATH C_PREDEF OBJS USERLIB SRC_DIRS

